var ie=Object.defineProperty;var oe=(e,l,v)=>l in e?ie(e,l,{enumerable:!0,configurable:!0,writable:!0,value:v}):e[l]=v;var N=(e,l,v)=>(oe(e,typeof l!="symbol"?l+"":l,v),v);import{o as se,f as re,a as ue,c as ce,g as de,p as fe,b as ve,Q as me,h as Y,e as pe,j as H,n as K,k as ge}from"./QSeparator.da812eb8.js";import{a as L,aX as he,aY as be,d as S,h as I,e as te,j as M,r as $,a4 as ye,a7 as O,$ as Fe,al as Se,a3 as Ve,aZ as xe,a9 as Ce,aa as _e,u as ze,aj as qe,v as je,p as Ae,aQ as ke,A as Pe,a_ as Ie,K as Re,i as G,a$ as Qe,aH as $e,q as De,C as Ne,D as Q,E as we,F,H as Be,I as Ee,G as A,P as D,Q as Z,O as J}from"./index.29d31375.js";import{a as Oe,Q as Te}from"./QPage.30e157c8.js";import"./use-dark.c3ec4070.js";var Ue=L({name:"QCardActions",props:{...he,vertical:Boolean},setup(e,{slots:l}){const v=be(e),x=S(()=>`q-card__actions ${v.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>I("div",{class:x.value},te(l.default))}});function w(e,l,v,x){const o=[];return e.forEach(d=>{x(d)===!0?o.push(d):l.push({failedPropValidation:v,file:d})}),o}function E(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),O(e)}const Ke={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Le=["rejected"];function Me({editable:e,dnd:l,getFileInput:v,addFilesToQueue:x}){const{props:o,emit:d,proxy:m}=M(),C=$(null),z=S(()=>o.accept!==void 0?o.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),u=S(()=>parseInt(o.maxFiles,10)),k=S(()=>parseInt(o.maxTotalSize,10));function _(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ye(t);else{const n=v();n&&n!==t.target&&n.click(t)}}function p(t){e.value&&t&&x(null,t)}function a(t,n,g,b){let s=Array.from(n||t.target.files);const y=[],R=()=>{y.length!==0&&d("rejected",y)};if(o.accept!==void 0&&z.value.indexOf("*/")===-1&&(s=w(s,y,"accept",f=>z.value.some(h=>f.type.toUpperCase().startsWith(h)||f.name.toUpperCase().endsWith(h))),s.length===0))return R();if(o.maxFileSize!==void 0){const f=parseInt(o.maxFileSize,10);if(s=w(s,y,"max-file-size",h=>h.size<=f),s.length===0)return R()}if(o.multiple!==!0&&s.length!==0&&(s=[s[0]]),s.forEach(f=>{f.__key=f.webkitRelativePath+f.lastModified+f.name+f.size}),b===!0){const f=g.map(h=>h.__key);s=w(s,y,"duplicate",h=>f.includes(h.__key)===!1)}if(s.length===0)return R();if(o.maxTotalSize!==void 0){let f=b===!0?g.reduce((h,T)=>h+T.size,0):0;if(s=w(s,y,"max-total-size",h=>(f+=h.size,f<=k.value)),s.length===0)return R()}if(typeof o.filter=="function"){const f=o.filter(s);s=w(s,y,"filter",h=>f.includes(h))}if(o.maxFiles!==void 0){let f=b===!0?g.length:0;if(s=w(s,y,"max-files",()=>(f++,f<=u.value)),s.length===0)return R()}if(R(),s.length!==0)return s}function c(t){E(t),l.value!==!0&&(l.value=!0)}function r(t){O(t),(t.relatedTarget!==null||Fe.is.safari!==!0?t.relatedTarget!==C.value:document.elementsFromPoint(t.clientX,t.clientY).includes(C.value)===!1)===!0&&(l.value=!1)}function q(t){E(t);const n=t.dataTransfer.files;n.length!==0&&x(null,n),l.value=!1}function P(t){if(l.value===!0)return I("div",{ref:C,class:`q-${t}__dnd absolute-full`,onDragenter:E,onDragover:E,onDragleave:r,onDrop:q})}return Object.assign(m,{pickFiles:_,addFiles:p}),{pickFiles:_,addFiles:p,onDragover:c,onDragleave:r,processFiles:a,getDndNode:P,maxFilesNumber:u,maxTotalSizeNumber:k}}var ee=L({name:"QFile",inheritAttrs:!1,props:{...se,...re,...Ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ue,...Le],setup(e,{slots:l,emit:v,attrs:x}){const{proxy:o}=M(),d=ce(),m=$(null),C=$(!1),z=de(e),{pickFiles:u,onDragover:k,onDragleave:_,processFiles:p,getDndNode:a}=Me({editable:d.editable,dnd:C,getFileInput:W,addFilesToQueue:X}),c=fe(e),r=S(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),q=S(()=>Y(r.value)),P=S(()=>r.value.map(i=>i.name).join(", ")),t=S(()=>xe(r.value.reduce((i,V)=>i+V.size,0))),n=S(()=>({totalSize:t.value,filesNumber:r.value.length,maxFiles:e.maxFiles})),g=S(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:z.value,...x,id:d.targetUid.value,disabled:d.editable.value!==!0})),b=S(()=>"q-file q-field--auto-height"+(C.value===!0?" q-file--dnd":"")),s=S(()=>e.multiple===!0&&e.append===!0);function y(i){const V=r.value.slice();V.splice(i,1),f(V)}function R(i){const V=r.value.indexOf(i);V!==-1&&y(V)}function f(i){v("update:modelValue",e.multiple===!0?i:i[0])}function h(i){i.keyCode===13&&Ve(i)}function T(i){(i.keyCode===13||i.keyCode===32)&&u(i)}function W(){return m.value}function X(i,V){const j=p(i,V,r.value,s.value),U=W();U!=null&&(U.value=""),j!==void 0&&((e.multiple===!0?e.modelValue&&j.every(ne=>r.value.includes(ne)):e.modelValue===j[0])||f(s.value===!0?r.value.concat(j):j))}function B(){return[I("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ae(){if(l.file!==void 0)return r.value.length===0?B():r.value.map((V,j)=>l.file({index:j,file:V,ref:this}));if(l.selected!==void 0)return r.value.length===0?B():l.selected({files:r.value,ref:this});if(e.useChips===!0)return r.value.length===0?B():r.value.map((V,j)=>I(me,{key:"file-"+j,removable:d.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{y(j)}},()=>I("span",{class:"ellipsis",textContent:V.name})));const i=e.displayValue!==void 0?e.displayValue:P.value;return i.length!==0?[I("div",{class:e.inputClass,style:e.inputStyle,textContent:i})]:B()}function le(){const i={ref:m,...g.value,...c.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:X};return e.multiple===!0&&(i.multiple=!0),I("input",i)}return Object.assign(d,{fieldClass:b,emitValue:f,hasValue:q,inputRef:m,innerValue:r,floatingLabel:S(()=>q.value===!0||Y(e.displayValue)),computedCounter:S(()=>{if(e.counterLabel!==void 0)return e.counterLabel(n.value);const i=e.maxFiles;return`${r.value.length}${i!==void 0?" / "+i:""} (${t.value})`}),getControlChild:()=>a("file"),getControl:()=>{const i={ref:d.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return d.editable.value===!0&&Object.assign(i,{onDragover:k,onDragleave:_,onKeydown:h,onKeyup:T}),I("div",i,[le()].concat(ae()))}}),Object.assign(o,{removeAtIndex:y,removeFile:R,getNativeElement:()=>m.value}),Se(o,"nativeEl",()=>m.value),ve(d)}}),We=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:l,emit:v}){const x=M(),o=$(null);let d=0;const m=[];function C(a){const c=typeof a=="boolean"?a:e.noErrorFocus!==!0,r=++d,q=(n,g)=>{v(`validation${n===!0?"Success":"Error"}`,g)},P=n=>{const g=n.validate();return typeof g.then=="function"?g.then(b=>({valid:b,comp:n}),b=>({valid:!1,comp:n,err:b})):Promise.resolve({valid:g,comp:n})};return(e.greedy===!0?Promise.all(m.map(P)).then(n=>n.filter(g=>g.valid!==!0)):m.reduce((n,g)=>n.then(()=>P(g).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return r===d&&q(!0),!0;if(r===d){const{comp:g,err:b}=n[0];if(b!==void 0&&console.error(b),q(!1,g),c===!0){const s=n.find(({comp:y})=>typeof y.focus=="function"&&qe(y.$)===!1);s!==void 0&&s.comp.focus()}}return!1})}function z(){d++,m.forEach(a=>{typeof a.resetValidation=="function"&&a.resetValidation()})}function u(a){a!==void 0&&O(a);const c=d+1;C().then(r=>{c===d&&r===!0&&(e.onSubmit!==void 0?v("submit",a):a!==void 0&&a.target!==void 0&&typeof a.target.submit=="function"&&a.target.submit())})}function k(a){a!==void 0&&O(a),v("reset"),je(()=>{z(),e.autofocus===!0&&e.noResetFocus!==!0&&_()})}function _(){pe(()=>{if(o.value===null)return;const a=o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),c=>c.tabIndex!==-1);a!=null&&a.focus({preventScroll:!0})})}Ae(ke,{bindComponent(a){m.push(a)},unbindComponent(a){const c=m.indexOf(a);c!==-1&&m.splice(c,1)}});let p=!1;return Ce(()=>{p=!0}),_e(()=>{p===!0&&e.autofocus===!0&&_()}),ze(()=>{e.autofocus===!0&&_()}),Object.assign(x.proxy,{validate:C,resetValidation:z,submit:u,reset:k,focus:_,getValidationComponents:()=>m}),()=>I("form",{class:"q-form",ref:o,onSubmit:u,onReset:k},te(l.default))}});class Xe{constructor(){N(this,"title");N(this,"creator");N(this,"description");N(this,"video");N(this,"cover");this.title="",this.creator="",this.description="",this.video=null,this.cover=null}reset(){this.title="",this.creator="",this.description="",this.video=null,this.cover=null}getSize(){let l=0;return l+=new Blob([this.title]).size,l+=new Blob([this.creator]).size,l+=new Blob([this.description]).size,this.cover&&(l+=this.cover.size),this.video&&(l+=this.video.size),l}}const Ye={class:"row q-col-gutter-md"},He={class:"col"},Ge={class:"col"},Ze={class:"row q-col-gutter-md q-pt-md"},Je={class:"col"},et={class:"col"},tt={class:"row q-col-gutter-md q-pt-md"},st=Pe({__name:"UploadPage",setup(e){const l=Ie(),v=Re(),x=G(Qe),o=G($e),d=$(null),m=$(null),C=$(null),z=$(null),u=De(new Xe);async function k(){var q,P,t,n;const p=(q=d.value)==null?void 0:q.validate(),a=(P=m.value)==null?void 0:P.validate(),c=(t=C.value)==null?void 0:t.validate(),r=(n=z.value)==null?void 0:n.validate();!p||!a||!c||!r||!u.video||!u.cover||await x.post(u)}function _(){l.notify({type:"negative",message:v.t("error-message.file-size-exceeded"),position:"top"})}return(p,a)=>(we(),Ne(Oe,{class:"row items-center justify-evenly"},{default:Q(()=>[F(Te,null,{default:Q(()=>[F(H,{class:"q-pa-none q-pb-md text-h5"},{default:Q(()=>[Be(Ee(p.$t("upload.title")),1)]),_:1}),F(H,{class:"q-pa-none"},{default:Q(()=>[F(A(We),{class:"q-gutter-md"},{default:Q(()=>[D("div",Ye,[D("div",He,[F(A(K),{ref_key:"titleRef",ref:d,modelValue:u.title,"onUpdate:modelValue":a[0]||(a[0]=c=>u.title=c),placeholder:p.$t("upload.placeholder.title"),rules:[()=>A(o).isSet(u.title)],autofocus:!1,required:"",standout:"",maxlength:"120"},null,8,["modelValue","placeholder","rules"])]),D("div",Ge,[F(A(K),{ref_key:"creatorRef",ref:m,modelValue:u.creator,"onUpdate:modelValue":a[1]||(a[1]=c=>u.creator=c),placeholder:p.$t("upload.placeholder.creator"),rules:[()=>A(o).isSet(u.creator)],autofocus:!1,required:"",standout:"",maxlength:"120"},null,8,["modelValue","placeholder","rules"])])]),D("div",Ze,[D("div",Je,[F(A(ee),{ref_key:"videoRef",ref:C,modelValue:u.video,"onUpdate:modelValue":a[2]||(a[2]=c=>u.video=c),label:p.$t("upload.placeholder.video"),rules:[()=>A(o).isSet(u.video)],onRejected:_,accept:"video/*","max-file-size":"4294967296",standout:"",clearable:""},{prepend:Q(()=>[F(Z,{name:"attach_file"})]),_:1},8,["modelValue","label","rules"])]),D("div",et,[F(A(ee),{ref_key:"coverRef",ref:z,modelValue:u.cover,"onUpdate:modelValue":a[3]||(a[3]=c=>u.cover=c),label:p.$t("upload.placeholder.cover"),rules:[()=>A(o).isSet(u.cover)],onRejected:_,accept:"image/*","max-file-size":"10485760",standout:"",clearable:""},{prepend:Q(()=>[F(Z,{name:"attach_file"})]),_:1},8,["modelValue","label","rules"])])]),D("div",tt,[F(A(K),{modelValue:u.description,"onUpdate:modelValue":a[4]||(a[4]=c=>u.description=c),placeholder:p.$t("upload.placeholder.description"),autofocus:!1,standout:"",type:"textarea",class:"full-width",maxlength:"5000"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1}),F(ge,{class:"q-my-md"}),F(Ue,{align:"center",class:"q-pa-none"},{default:Q(()=>[F(J,{label:p.$t("upload.label.reset"),onClick:a[5]||(a[5]=c=>u.reset()),color:"grey-5","no-caps":"","text-color":"black",unelevated:""},null,8,["label"]),F(J,{label:p.$t("upload.label.upload"),onClick:k,color:"primary","no-caps":"",unelevated:""},null,8,["label"])]),_:1})]),_:1})]),_:1}))}});export{st as default};
